#!/usr/bin/env bash
set -e

# Ruta del entorno virtual
VENV_DIR="venv"

# Crear el entorno si no existe
if [ ! -d "$VENV_DIR" ]; then
    echo "Creando entorno virtual en $VENV_DIR..."
    python3 -m venv "$VENV_DIR"
fi

# Activar el entorno
echo "Activando entorno virtual..."
source "$VENV_DIR/bin/activate"

# Actualizar pip
echo "Actualizando pip..."
pip install --upgrade pip

# Instalar dependencias de Python
echo "Instalando dependencias de Python..."
pip install python-dotenv pyTelegramBotAPI

# Instalar dependencias del sistema
echo "Instalando dependencias del sistema..."
if command -v apt >/dev/null 2>&1; then
    sudo apt update
    sudo apt install -y imagemagick streamer espeak libnotify-bin notify-osd
elif command -v brew >/dev/null 2>&1; then
    brew install imagemagick streamer espeak libnotify
else
    echo "⚠️ No se detectó ni apt ni brew. Instala manualmente las dependencias del sistema."
fi

echo "✅ Entorno configurado correctamente."
echo
echo "Para usarlo en el futuro, ejecutá:"
echo "  source $VENV_DIR/bin/activate"
